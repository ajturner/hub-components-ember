(window.webpackJsonp_ember_auto_import_=window.webpackJsonp_ember_auto_import_||[]).push([[35],{44:function(e,t,r){"use strict"
r.r(t),r.d(t,"hub_follow_button",function(){return _})
var n=r(0),i=r(50),o=r(53)
function s(e,t,r,n){var i=(r||"https://www.arcgis.com/sharing/rest")+"/content/items/"+e+"/resources"
return n?i+"/"+n+"/"+t:i+"/"+t}var a=function(e){return Object.keys(e).reduce(function(t,r){var n=e[r]
if(function(e){var t=!1
return Array.isArray(e.fields)&&e.fields.length>0&&(t=!0),t}(n)){var o=Object(i.x)(n)
o.id=r,t.push(o)}return t},[])},u=function(e){return{id:e.id,name:e.field.name,alias:e.field.alias,type:e.field.type}},c=function(e){return{type:"Feature Layer",url:e.url,itemId:e.itemId,layerId:e.layerId,name:e.name||e.id,mappings:e.fields.map(u)}},p=function(e){return{id:e.id,type:"Data",name:e.name||e.id,definition:{description:e.name||e.id},source:c(e)}},h=function(e,t){return e&&Array.isArray(e)?e.map(function(e){return n=(r=t[e]).templates||[],i=r.items||[],{title:r.title,description:r.description,id:r.id,templateIds:n.map(l),itemIds:i.map(l)}
var r,n,i}):[]}
function l(e){return e.id}function f(e,t){return 2.1===Object(i.h)(e,"item.properties.schemaVersion")?e:e=function(e){if(Object(i.h)(e,"item.properties.schemaVersion")<2.1){var t=Object(i.x)(e)
t.item.properties.schemaVersion=2.1
var r=Object(i.h)(e,"item.properties.groupId")
return r&&(t.item.properties.collaborationGroupId=r,delete t.item.properties.groupId),t}return e}(e=function(e,t){var r
if(Object(i.h)(e,"item.properties.schemaVersion")<2){var n=Object(i.x)(e)
return n.item.properties.schemaVersion=2,n.data.steps=h(n.data.values.steps,n.data.values),n.data.values.steps&&(n.data.values.steps.forEach(function(e){delete n.data.values[e]}),delete n.data.values.steps),n.data.indicators=(r=n.data.values,a(r).map(p)),n}return e}(e=function(e,t){if(Object(i.h)(e,"item.properties.schemaVersion")<1.1){var r=Object(i.x)(e)
return r.item.properties.schemaVersion=1.1,function(e,t){e.data.assets||(e.data.assets=[{id:"bannerImage",url:s(e.item.id,"detail-image.jpg",t),properties:{type:"resource",fileName:"detail-image.jpg",mimeType:"image/jepg"},license:{type:"none"}},{id:"iconDark",url:s(e.item.id,"icon-dark.png",t),properties:{type:"resource",fileName:"icon-dark.png",mimeType:"image/png"},license:{type:"none"}},{id:"iconLight",url:s(e.item.id,"icon-light.png",t),properties:{type:"resource",fileName:"icon-light.png",mimeType:"image/png"},license:{type:"none"}}])}(r,t),r.data.values.bannerImage||(r.data.values.bannerImage={source:"bannerImage",display:{position:{x:"50%",y:"10%"}}}),r}return e}(e=function(e,t){var r=Object(i.h)(e,"item.properties.schemaVersion")
if(!r||r<1){var n=Object(i.x)(e)
n.data.values||(n.data.values={}),n.item.properties||(n.item.properties={}),n.item.properties.schemaVersion=1
var o=!1
if(n.item.typeKeywords&&(o=n.item.typeKeywords.indexOf("hubInitiativeTemplate")>=0),!!n.data.source&&n.item.properties.source!==n.data.source&&(n.item.properties.source=n.data.source),n.data.configurationSettings){var s=Object(i.x)(n.data.configurationSettings)
delete n.data.configurationSettings
var a=s.find(function(e){return"Steps"===e.category})
n.data.values.steps=a.fields.map(function(e){return e.fieldName}),a.fields.forEach(function(e){n.data.values[e.fieldName]||(n.data.values[e.fieldName]={}),n.data.values[e.fieldName].title=e.label,n.data.values[e.fieldName].description=e.tooltip,n.data.values[e.fieldName].id=e.fieldName,n.data.values[e.fieldName].items?o&&(n.data.values[e.fieldName].templates=n.data.values[e.fieldName].items,delete n.data.values[e.fieldName].items):(n.data.values[e.fieldName].items=[],n.data.values[e.fieldName].templates=[])})}return n}return e}(e),t)))}function d(e,t){return Promise.all([Object(i.j)(e,t),Object(i.e)(e,t)]).then(function(e){return{item:e[0],data:e[1]}}).then(function(e){return f(e,Object(i.y)(t))})}var m=function(e){return"hubInitiativeId|"+e},g=function(e){return e.replace(/^hubInitiativeId\|/,"")},v=function(e){return e.replace(/^hubInitiativeFollowers\|/,"")},k=function(e){return Object(i.z)(e)+"/update"},w=function(e){return e.groups.map(function(e){return e.tags}).reduce(function(e,t){return e.concat(t)},[]).filter(function(e){return 0===e.indexOf("hubInitiativeFollowers|")}).map(v)},T=function(e,t){return function(e){var t=function(e){return e.tags.map(g)}(e),r=w(e)
return t.concat(r).filter(i.A)}(e).indexOf(t)>-1},_=function(){function e(e){var t=this
Object(n.h)(this,e),this.icon=Object(n.g)("svg",{class:"follow-icon",viewBox:"0 0 120 120",width:"100%",height:"100%"},Object(n.g)("circle",{cx:"18.385",cy:"101.615",r:"18.385"}),Object(n.g)("path",{d:"M-1.031 61c32.533 0 59 26.468 59 59s-26.467 59-59 59-59-26.468-59-59 26.467-59 59-59m0-23c-45.288 0-82 36.713-82 82s36.712 82 82 82 82-36.713 82-82-36.712-82-82-82z"}),Object(n.g)("path",{d:"M.154 23.041c53.349 0 96.75 43.402 96.75 96.75s-43.402 96.75-96.75 96.75-96.75-43.402-96.75-96.75 43.402-96.75 96.75-96.75m0-23c-66.136 0-119.75 53.615-119.75 119.75s53.614 119.75 119.75 119.75c66.135 0 119.75-53.615 119.75-119.75S66.289.041.154.041z"})),this.orgurl="https://www.arcgis.com",this.following=!1,this.callToActionText="Follow Our Initiative",this.triggerFollow=function(){return t.session=Object(o.b)(),t.session?t.toggleFollow():o.a.beginOAuth2({clientId:t.clientid,portal:t.orgurl+"/sharing/rest",redirectUri:window.location+"authenticate.html"}).then(function(e){return Object(o.c)(e),t.session=e.serialize(),t.toggleFollow()})},this.toggleFollow=function(){return t.following?function(e){return Object(i.u)(Object(i.z)(e.authentication),{authentication:e.authentication}).then(function(t){return T(t,e.initiativeId)?t:Promise.reject("user is not following this initiative.")}).then(function(t){var r=m(e.initiativeId),n=JSON.parse(JSON.stringify(t.tags))
if(n.indexOf(r)>-1){var o=n.indexOf(r)
return n.splice(o,1),0===n.length&&n.push(","),Object(i.u)(k(e.authentication),{params:{tags:n},authentication:e.authentication}).then(function(e){return t})}return t}).then(function(t){return d(e.initiativeId,e).then(function(e){return{user:t,initiative:e}})}).then(function(t){var r=Object(i.h)(t,"initiative.item.properties.followersGroupId")
return r&&w(t.user).indexOf(e.initiativeId)>-1?Object(i.t)({id:r,authentication:e.authentication}).then(function(e){return{success:!0,username:t.user.username}}):{success:!0,username:t.user.username}})}({initiativeId:t.initiativeid,authentication:o.a.deserialize(t.session)}).then(function(e){if(e.success)return Promise.resolve()}).catch(function(e){if("user is not following this initiative."===e)return Promise.resolve()}).then(function(){return t.callToActionText="Follow Our Initiative",t.following=!1,{success:!0}}):(e={initiativeId:t.initiativeid,authentication:o.a.deserialize(t.session)},Object(i.u)(Object(i.z)(e.authentication),{authentication:e.authentication}).then(function(t){return T(t,e.initiativeId)?Promise.reject("user is already following this initiative."):t}).then(function(t){return d(e.initiativeId,e).then(function(e){return{user:t,initiative:e,hasFollowersGroup:!1}})}).then(function(t){var r=Object(i.h)(t,"initiative.item.properties.followersGroupId")
return r?Object(i.s)({id:r,authentication:e.authentication}).then(function(e){return t.hasFollowersGroup=e.success,t}):t}).then(function(t){if(!t.hasFollowersGroup){var r=m(e.initiativeId),n=JSON.parse(JSON.stringify(t.user.tags))
return n.push(r),Object(i.u)(k(e.authentication),{params:{tags:n},authentication:e.authentication})}return{success:!0,username:t.user.username}})).then(function(e){if(e.success)return Promise.resolve(e)}).catch(function(e){if("user is already following this initiative."===e)return Promise.resolve()}).then(function(){return t.callToActionText="Unfollow Our Initiative",t.following=!0,{success:!0}})
var e}}return e.prototype.render=function(){return Object(n.g)("hub-button",{text:this.callToActionText,action:this.triggerFollow,icon:this.icon})},Object.defineProperty(e,"style",{get:function(){return".follow-icon{height:15px;width:15px;vertical-align:baseline;padding-right:5px;fill:currentColor}"},enumerable:!0,configurable:!0}),e}()},53:function(e,t,r){"use strict"
r.d(t,"a",function(){return p}),r.d(t,"b",function(){return h}),r.d(t,"c",function(){return l})
var n=r(50)
function i(e,t){var r=t
return r.rawResponse=!1,Object(n.u)(e,r).then(function(e){var t={token:e.access_token,username:e.username,expires:new Date(Date.now()+(1e3*e.expires_in-1e3)),ssl:!0===e.ssl}
return e.refresh_token&&(t.refreshToken=e.refresh_token),t})}function o(e,t){var r=t
return"undefined"!=typeof window&&window.location&&window.location.host?r.params.referer=window.location.host:r.params.referer=n.b,Object(n.u)(e,r)}var s=/^https?:\/\/(\S+)\.arcgis\.com.+/
function a(e){return s.test(e)}function u(e){if(!s.test(e))return null
var t=e.match(s)[1].split(".").pop()
return t.includes("dev")?"dev":t.includes("qa")?"qa":"production"}function c(e,t){var r=Object(n.f)(function(e){if(!s.test(e))return e
switch(u(e)){case"dev":return"https://devext.arcgis.com/sharing/rest"
case"qa":return"https://qaext.arcgis.com/sharing/rest"
default:return"https://www.arcgis.com/sharing/rest"}}(t)).replace(/https?:\/\//,""),i=Object(n.f)(e).replace(/https?:\/\//,"")
return new RegExp(i,"i").test(r)}var p=function(){function e(e){if(this.clientId=e.clientId,this._refreshToken=e.refreshToken,this._refreshTokenExpires=e.refreshTokenExpires,this.username=e.username,this.password=e.password,this._token=e.token,this._tokenExpires=e.tokenExpires,this.portal=e.portal?Object(n.f)(e.portal):"https://www.arcgis.com/sharing/rest",this.ssl=e.ssl,this.provider=e.provider||"arcgis",this.tokenDuration=e.tokenDuration||20160,this.redirectUri=e.redirectUri,this.refreshTokenTTL=e.refreshTokenTTL||1440,this.trustedServers={},e.server){var t=this.getServerRootUrl(e.server)
this.trustedServers[t]={token:e.token,expires:e.tokenExpires}}this._pendingTokenRequests={}}return e.beginOAuth2=function(t,r){void 0===r&&(r=window)
var i,o=Object(n.c)({portal:"https://www.arcgis.com/sharing/rest",provider:"arcgis",duration:20160,popup:!0,state:t.clientId,locale:""},t),s=o.portal,a=o.provider,u=o.clientId,c=o.duration,p=o.redirectUri,h=o.popup,l=o.state,f=o.locale,d=o.params
if(i="arcgis"===a?s+"/oauth2/authorize?client_id="+u+"&response_type=token&expiration="+c+"&redirect_uri="+encodeURIComponent(p)+"&state="+l+"&locale="+f:s+"/oauth2/social/authorize?client_id="+u+"&socialLoginProviderName="+a+"&autoAccountCreateForSocial=true&response_type=token&expiration="+c+"&redirect_uri="+encodeURIComponent(p)+"&state="+l+"&locale="+f,d&&(i=i+"&"+Object(n.q)(d)),h){var m,g=((m={promise:null,resolve:null,reject:null}).promise=new Promise(function(e,t){m.resolve=e,m.reject=t}),m)
return r["__ESRI_REST_AUTH_HANDLER_"+u]=function(t,r){if(t){var i=JSON.parse(t)
g.reject(new n.a(i.errorMessage,i.error))}else if(r){var o=JSON.parse(r)
g.resolve(new e({clientId:u,portal:s,ssl:o.ssl,token:o.token,tokenExpires:new Date(o.expires),username:o.username}))}},r.open(i,"oauth-window","height=400,width=600,menubar=no,location=yes,resizable=yes,scrollbars=yes,status=yes"),g.promise}r.location.href=i},e.completeOAuth2=function(t,r){void 0===r&&(r=window)
var i=Object(n.c)({portal:"https://www.arcgis.com/sharing/rest",popup:!0},t),o=i.portal,s=i.clientId,a=i.popup
function u(t,i){try{var u
if(a&&r.opener&&r.opener.parent&&r.opener.parent["__ESRI_REST_AUTH_HANDLER_"+s])return(u=r.opener.parent["__ESRI_REST_AUTH_HANDLER_"+s])&&u(t?JSON.stringify(t):void 0,JSON.stringify(i)),void r.close()
if(a&&r!==r.parent&&r.parent&&r.parent["__ESRI_REST_AUTH_HANDLER_"+s])return(u=r.parent["__ESRI_REST_AUTH_HANDLER_"+s])&&u(t?JSON.stringify(t):void 0,JSON.stringify(i)),void r.close()}catch(e){throw new n.a('Unable to complete authentication. It\'s possible you specified popup based oAuth2 but no handler from "beginOAuth2()" present. This generally happens because the "popup" option differs between "beginOAuth2()" and "completeOAuth2()".')}if(t)throw new n.a(t.errorMessage,t.error)
return new e({clientId:s,portal:o,ssl:i.ssl,token:i.token,tokenExpires:i.expires,username:i.username})}var c=r.location.href.match(/access_token=(.+)&expires_in=(.+)&username=([^&]+)/)
if(!c){var p=r.location.href.match(/error=(.+)&error_description=(.+)/)
return u({error:p[1],errorMessage:decodeURIComponent(p[2])})}var h=c[1],l=new Date(Date.now()+1e3*parseInt(c[2],10)-6e4),f=decodeURIComponent(c[3])
return u(void 0,{token:h,expires:l,ssl:r.location.href.indexOf("&ssl=true")>-1||r.location.href.indexOf("#ssl=true")>-1,username:f})},e.authorize=function(e,t){var r=Object(n.c)({portal:"https://arcgis.com/sharing/rest",duration:20160},e),i=r.portal,o=r.clientId,s=r.duration,a=r.redirectUri
t.writeHead(301,{Location:i+"/oauth2/authorize?client_id="+o+"&duration="+s+"&response_type=code&redirect_uri="+encodeURIComponent(a)}),t.end()},e.exchangeAuthorizationCode=function(t,r){var o=Object(n.c)({portal:"https://www.arcgis.com/sharing/rest",refreshTokenTTL:1440},t),s=o.portal,a=o.clientId,u=o.redirectUri,c=o.refreshTokenTTL
return i(s+"/oauth2/token",{params:{grant_type:"authorization_code",client_id:a,redirect_uri:u,code:r}}).then(function(t){return new e({clientId:a,portal:s,ssl:t.ssl,redirectUri:u,refreshToken:t.refreshToken,refreshTokenTTL:c,refreshTokenExpires:new Date(Date.now()+1e3*(c-1)),token:t.token,tokenExpires:t.expires,username:t.username})})},e.deserialize=function(t){var r=JSON.parse(t)
return new e({clientId:r.clientId,refreshToken:r.refreshToken,refreshTokenExpires:new Date(r.refreshTokenExpires),username:r.username,password:r.password,token:r.token,tokenExpires:new Date(r.tokenExpires),portal:r.portal,ssl:r.ssl,tokenDuration:r.tokenDuration,redirectUri:r.redirectUri,refreshTokenTTL:r.refreshTokenTTL})},e.fromCredential=function(t){return new e({portal:t.server.includes("sharing/rest")?t.server:t.server+"/sharing/rest",ssl:t.ssl,token:t.token,username:t.userId,tokenExpires:new Date(t.expires)})},Object.defineProperty(e.prototype,"token",{get:function(){return this._token},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tokenExpires",{get:function(){return this._tokenExpires},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"refreshToken",{get:function(){return this._refreshToken},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"refreshTokenExpires",{get:function(){return this._refreshTokenExpires},enumerable:!0,configurable:!0}),e.prototype.toCredential=function(){return{expires:this.tokenExpires.getTime(),server:this.portal,ssl:this.ssl,token:this.token,userId:this.username}},e.prototype.getUser=function(e){var t=this
if(this._user&&this._user.username===this.username)return Promise.resolve(this._user)
var r=this.portal+"/community/users/"+encodeURIComponent(this.username),i=Object(n.c)({httpMethod:"GET",authentication:this},e,{rawResponse:!1})
return Object(n.u)(r,i).then(function(e){return t._user=e,e})},e.prototype.getToken=function(e,t){return n=e,i=a(r=this.portal),o=a(n),s=u(r),c=u(n),i&&o&&s===c||new RegExp(this.portal,"i").test(e)?this.getFreshToken(t):this.getTokenForServer(e,t)
var r,n,i,o,s,c},e.prototype.toJSON=function(){return{clientId:this.clientId,refreshToken:this.refreshToken,refreshTokenExpires:this.refreshTokenExpires,username:this.username,password:this.password,token:this.token,tokenExpires:this.tokenExpires,portal:this.portal,ssl:this.ssl,tokenDuration:this.tokenDuration,redirectUri:this.redirectUri,refreshTokenTTL:this.refreshTokenTTL}},e.prototype.serialize=function(){return JSON.stringify(this)},e.prototype.refreshSession=function(e){return this._user=null,this.username&&this.password?this.refreshWithUsernameAndPassword(e):this.clientId&&this.refreshToken?this.refreshWithRefreshToken():Promise.reject(new n.a("Unable to refresh token."))},e.prototype.getServerRootUrl=function(e){var t=Object(n.f)(e).split(/\/rest(\/admin)?\/services(?:\/|#|\?|$)/)[0].match(/(https?:\/\/)(.+)/),r=t[1],i=t[2].split("/"),o=i[0],s=i.slice(1)
return""+r+o.toLowerCase()+"/"+s.join("/")},e.prototype.getTokenForServer=function(e,t){var r=this,i=this.getServerRootUrl(e),s=this.trustedServers[i]
return s&&s.expires&&s.expires.getTime()>Date.now()?Promise.resolve(s.token):(this._pendingTokenRequests[i]||(this._pendingTokenRequests[i]=Object(n.u)(i+"/rest/info").then(function(o){if(o.owningSystemUrl){if(c(o.owningSystemUrl,r.portal))return Object(n.u)(o.owningSystemUrl+"/sharing/rest/info",t)
throw new n.a(e+" is not federated with "+r.portal+".","NOT_FEDERATED")}if(o.authInfo&&void 0!==r.trustedServers[i])return Promise.resolve({authInfo:o.authInfo})
throw new n.a(e+" is not federated with any portal and is not explicitly trusted.","NOT_FEDERATED")}).then(function(e){return e.authInfo.tokenServicesUrl}).then(function(t){return r.token&&r.tokenExpires.getTime()>Date.now()?o(t,{params:{token:r.token,serverUrl:e,expiration:r.tokenDuration,client:"referer"}}):o(t,{params:{username:r.username,password:r.password,expiration:r.tokenDuration,client:"referer"}}).then(function(e){return r._token=e.token,r._tokenExpires=new Date(e.expires),e})}).then(function(e){return r.trustedServers[i]={expires:new Date(e.expires),token:e.token},delete r._pendingTokenRequests[i],e.token})),this._pendingTokenRequests[i])},e.prototype.getFreshToken=function(e){var t=this
return this.token&&this.tokenExpires&&this.tokenExpires.getTime()>Date.now()?Promise.resolve(this.token):(this._pendingTokenRequests[this.portal]||(this._pendingTokenRequests[this.portal]=this.refreshSession(e).then(function(e){return t._pendingTokenRequests[t.portal]=null,e.token})),this._pendingTokenRequests[this.portal])},e.prototype.refreshWithUsernameAndPassword=function(e){var t=this,r=Object(n.c)({params:{username:this.username,password:this.password,expiration:this.tokenDuration}},e)
return o(this.portal+"/generateToken",r).then(function(e){return t._token=e.token,t._tokenExpires=new Date(e.expires),t})},e.prototype.refreshWithRefreshToken=function(e){var t=this
if(this.refreshToken&&this.refreshTokenExpires&&this.refreshTokenExpires.getTime()<Date.now())return this.refreshRefreshToken(e)
var r=Object(n.c)({params:{client_id:this.clientId,refresh_token:this.refreshToken,grant_type:"refresh_token"}},e)
return i(this.portal+"/oauth2/token",r).then(function(e){return t._token=e.token,t._tokenExpires=e.expires,t})},e.prototype.refreshRefreshToken=function(e){var t=this,r=Object(n.c)({params:{client_id:this.clientId,refresh_token:this.refreshToken,redirect_uri:this.redirectUri,grant_type:"exchange_refresh_token"}},e)
return i(this.portal+"/oauth2/token",r).then(function(e){return t._token=e.token,t._tokenExpires=e.expires,t._refreshToken=e.refreshToken,t._refreshTokenExpires=new Date(Date.now()+60*(t.refreshTokenTTL-1)*1e3),t})},e}(),h=function(){var e=document.cookie.match("(^|[^;]+)\\s*arcgis_hub_component_auth\\s*=\\s*([^;]+)")
return e?e.pop():void 0},l=function(e){var t=new Date
t.setTime(t.getTime()+12096e5),document.cookie="arcgis_hub_component_auth="+e.serialize()+" ; expires="+t.toUTCString()+" path=/"}}}])
