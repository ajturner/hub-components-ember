(window.webpackJsonp_ember_auto_import_=window.webpackJsonp_ember_auto_import_||[]).push([[19],{42:function(e,t,r){"use strict"
r.r(t),r.d(t,"hub_event",function(){return u})
var n=r(0),i=r(48),o=r(49),s=r(51)
function a(e,t,r,n){var o=[],s=[],a=[],u=(new Date).getTime(),c=""
if(e.forEach(function(e){var r=e.attributes,i=e.geometry,a=null
if(r.imageAttributes){var h=JSON.parse(r.imageAttributes)
h.crop&&(a=t+"/"+r.OBJECTID+"/attachments/"+h.crop+"?v="+u,n&&(a+="&token="+n))}s.push({id:r.OBJECTID,type:"events",imageUrl:a,attributes:r,geometry:i})
var p=r.siteId
null!=p&&-1===o.indexOf(p)&&(o.push(p),c+=c.length>0?" OR id:":"id:",c+=p)}),0===o.length)return{included:a,data:s}
var h=r
return h.q=c,Object(i.v)(h).then(function(e){return e.results.forEach(function(e){a.push({id:e.id,type:"sites",attributes:{id:e.id,url:e.url}})}),{included:a,data:s}})}var u=function(){function e(e){var t=this
Object(n.h)(this,e),this.orgurl="https://www.arcgis.com",this.callToActionText="Attend",this.triggerRegister=function(){return t.session=Object(s.b)(),t.session?t.toggleRegister():s.a.beginOAuth2({clientId:t.clientid,portal:t.orgurl+"/sharing/rest",redirectUri:window.location+"authenticate.html"}).then(function(e){return Object(s.c)(e),t.session=e.serialize(),t.toggleRegister()})},this.toggleRegister=function(){return t.attending?function(e){return Object(i.t)({id:e.groupId,authentication:e.authentication})}({groupId:t.eventGroupId,authentication:s.a.deserialize(t.session)}).then(function(e){return!0===e.success?(t.callToActionText="Attend",t.attending=!1,{success:!0}):{success:!1}}):(e={groupId:t.eventGroupId,authentication:s.a.deserialize(t.session)},Object(i.s)({id:e.groupId,authentication:e.authentication})).then(function(e){if(!0===e.success)return Promise.resolve()}).catch(function(e){if("User is already a member of group."===e.originalMessage)return Promise.resolve()
throw e}).then(function(){return t.callToActionText="Attending",t.attending=!0,{success:!0}})
var e}}return e.prototype.componentDidLoad=function(){var e=this
Object(i.w)(null,{portal:this.orgurl+"/sharing/rest/"}).then(function(t){(function(e,t){return function(e,t){return Object(i.v)(Object(i.c)({q:"typekeywords:hubEventsLayer AND orgid:"+e},t)).then(function(e){var t=e
if(t.results&&t.results.length>0){var r=void 0
if(1===t.results.length)r=t.results[0]
else if(t.results.length>1){var n=t.results.reduce(function(e,t){return t.typeKeywords.includes("View Service")?"public"===t.access?e.public=t:e.org=t:e.admin=t,e},{})
r=n.admin||n.org||n.public}return r}throw Error("No events service found. Events are likely not enabled.")})}(e,t).then(function(r){var n=Object(i.r)(t),o=r.url.match(/services\/(.*?)\/FeatureServer/)
if(o[1])return n+"/api/v3/events/"+e+"/"+o[1]+"/FeatureServer/0"})})(t.id).then(function(t){var r,n
e.eventServiceUrl=t,(r={url:e.eventServiceUrl},n=Object(i.c)({returnGeometry:!0},r),Object(o.a)(n).then(function(e){return e.features.length<=0?{data:[],included:[]}:n.authentication?n.authentication.getToken(n.url).then(function(t){return a(e.features,n.url,r,t)}):a(e.features,n.url,r)})).then(function(t){if(t.data.length>0)for(var r=0;r<t.data.length;r++)if(t.data[r].attributes.title===e.eventtitle){var n=t.data[r].attributes
e.eventDate=new Date(n.startDate).toString(),e.eventGroupId=n.groupId,e.eventOrganizer=e.digOutContactInfo(n)
break}})})})},e.prototype.digOutContactInfo=function(e){var t=JSON.parse(e.organizers)
if(t.length>0){var r="mailto:"+t[0].contact
return Object(n.g)("p",null,"organized by: ",Object(n.g)("a",{href:r},t[0].name))}},e.prototype.render=function(){return Object(n.g)("div",{class:"hub-event-details"},Object(n.g)("div",{class:"hub-event-background-image"}),Object(n.g)("div",{class:"hub-event-content"},Object(n.g)("h3",null,this.eventtitle),Object(n.g)("p",null,this.eventDate),Object(n.g)("p",null,this.eventOrganizer)),Object(n.g)("div",{class:"hub-event-footer"},Object(n.g)("hub-button",{text:this.callToActionText,action:this.triggerRegister})))},Object.defineProperty(e,"style",{get:function(){return'.hub-event-details{border:1px solid #ccc;border-radius:4px;width:100%;color:#323232;font-size:14px;width:380px;height:400px;font-family:Arial;display:grid;grid-template-columns:auto;grid-template-rows:40% 40% 20%;grid-template-areas:"header" "main" "footer"}.hub-event-background-image{background-color:#ffae00;grid-area:header}.hub-event-content{grid-area:main;padding-left:40px;padding-right:40px}.hub-event-footer{grid-area:footer;padding-left:40px}'},enumerable:!0,configurable:!0}),e}()},49:function(e,t,r){"use strict"
r.d(t,"a",function(){return i})
var n=r(48)
function i(e){var t=Object(n.d)(e,["where","objectIds","relationParam","time","distance","units","outFields","geometry","geometryType","spatialRel","returnGeometry","maxAllowableOffset","geometryPrecision","inSR","outSR","gdbVersion","returnDistinctValues","returnIdsOnly","returnCountOnly","returnExtentOnly","orderByFields","groupByFieldsForStatistics","outStatistics","returnZ","returnM","multipatchOption","resultOffset","resultRecordCount","quantizationParameters","returnCentroid","resultType","historicMoment","returnTrueCurves","sqlFormat","returnExceededLimitFeatures","f"],{httpMethod:"GET",params:Object(n.c)({where:"1=1",outFields:"*"},e.params)})
return Object(n.u)(Object(n.f)(e.url)+"/query",t)}},51:function(e,t,r){"use strict"
r.d(t,"a",function(){return h}),r.d(t,"b",function(){return p}),r.d(t,"c",function(){return l})
var n=r(48)
function i(e,t){var r=t
return r.rawResponse=!1,Object(n.u)(e,r).then(function(e){var t={token:e.access_token,username:e.username,expires:new Date(Date.now()+(1e3*e.expires_in-1e3)),ssl:!0===e.ssl}
return e.refresh_token&&(t.refreshToken=e.refresh_token),t})}function o(e,t){var r=t
return"undefined"!=typeof window&&window.location&&window.location.host?r.params.referer=window.location.host:r.params.referer=n.b,Object(n.u)(e,r)}var s=/^https?:\/\/(\S+)\.arcgis\.com.+/
function a(e){return s.test(e)}function u(e){if(!s.test(e))return null
var t=e.match(s)[1].split(".").pop()
return t.includes("dev")?"dev":t.includes("qa")?"qa":"production"}function c(e,t){var r=Object(n.f)(function(e){if(!s.test(e))return e
switch(u(e)){case"dev":return"https://devext.arcgis.com/sharing/rest"
case"qa":return"https://qaext.arcgis.com/sharing/rest"
default:return"https://www.arcgis.com/sharing/rest"}}(t)).replace(/https?:\/\//,""),i=Object(n.f)(e).replace(/https?:\/\//,"")
return new RegExp(i,"i").test(r)}var h=function(){function e(e){if(this.clientId=e.clientId,this._refreshToken=e.refreshToken,this._refreshTokenExpires=e.refreshTokenExpires,this.username=e.username,this.password=e.password,this._token=e.token,this._tokenExpires=e.tokenExpires,this.portal=e.portal?Object(n.f)(e.portal):"https://www.arcgis.com/sharing/rest",this.ssl=e.ssl,this.provider=e.provider||"arcgis",this.tokenDuration=e.tokenDuration||20160,this.redirectUri=e.redirectUri,this.refreshTokenTTL=e.refreshTokenTTL||1440,this.trustedServers={},e.server){var t=this.getServerRootUrl(e.server)
this.trustedServers[t]={token:e.token,expires:e.tokenExpires}}this._pendingTokenRequests={}}return e.beginOAuth2=function(t,r){void 0===r&&(r=window)
var i,o=Object(n.c)({portal:"https://www.arcgis.com/sharing/rest",provider:"arcgis",duration:20160,popup:!0,state:t.clientId,locale:""},t),s=o.portal,a=o.provider,u=o.clientId,c=o.duration,h=o.redirectUri,p=o.popup,l=o.state,d=o.locale,f=o.params
if(i="arcgis"===a?s+"/oauth2/authorize?client_id="+u+"&response_type=token&expiration="+c+"&redirect_uri="+encodeURIComponent(h)+"&state="+l+"&locale="+d:s+"/oauth2/social/authorize?client_id="+u+"&socialLoginProviderName="+a+"&autoAccountCreateForSocial=true&response_type=token&expiration="+c+"&redirect_uri="+encodeURIComponent(h)+"&state="+l+"&locale="+d,f&&(i=i+"&"+Object(n.q)(f)),p){var g,k=((g={promise:null,resolve:null,reject:null}).promise=new Promise(function(e,t){g.resolve=e,g.reject=t}),g)
return r["__ESRI_REST_AUTH_HANDLER_"+u]=function(t,r){if(t){var i=JSON.parse(t)
k.reject(new n.a(i.errorMessage,i.error))}else if(r){var o=JSON.parse(r)
k.resolve(new e({clientId:u,portal:s,ssl:o.ssl,token:o.token,tokenExpires:new Date(o.expires),username:o.username}))}},r.open(i,"oauth-window","height=400,width=600,menubar=no,location=yes,resizable=yes,scrollbars=yes,status=yes"),k.promise}r.location.href=i},e.completeOAuth2=function(t,r){void 0===r&&(r=window)
var i=Object(n.c)({portal:"https://www.arcgis.com/sharing/rest",popup:!0},t),o=i.portal,s=i.clientId,a=i.popup
function u(t,i){try{var u
if(a&&r.opener&&r.opener.parent&&r.opener.parent["__ESRI_REST_AUTH_HANDLER_"+s])return(u=r.opener.parent["__ESRI_REST_AUTH_HANDLER_"+s])&&u(t?JSON.stringify(t):void 0,JSON.stringify(i)),void r.close()
if(a&&r!==r.parent&&r.parent&&r.parent["__ESRI_REST_AUTH_HANDLER_"+s])return(u=r.parent["__ESRI_REST_AUTH_HANDLER_"+s])&&u(t?JSON.stringify(t):void 0,JSON.stringify(i)),void r.close()}catch(e){throw new n.a('Unable to complete authentication. It\'s possible you specified popup based oAuth2 but no handler from "beginOAuth2()" present. This generally happens because the "popup" option differs between "beginOAuth2()" and "completeOAuth2()".')}if(t)throw new n.a(t.errorMessage,t.error)
return new e({clientId:s,portal:o,ssl:i.ssl,token:i.token,tokenExpires:i.expires,username:i.username})}var c=r.location.href.match(/access_token=(.+)&expires_in=(.+)&username=([^&]+)/)
if(!c){var h=r.location.href.match(/error=(.+)&error_description=(.+)/)
return u({error:h[1],errorMessage:decodeURIComponent(h[2])})}var p=c[1],l=new Date(Date.now()+1e3*parseInt(c[2],10)-6e4),d=decodeURIComponent(c[3])
return u(void 0,{token:p,expires:l,ssl:r.location.href.indexOf("&ssl=true")>-1||r.location.href.indexOf("#ssl=true")>-1,username:d})},e.authorize=function(e,t){var r=Object(n.c)({portal:"https://arcgis.com/sharing/rest",duration:20160},e),i=r.portal,o=r.clientId,s=r.duration,a=r.redirectUri
t.writeHead(301,{Location:i+"/oauth2/authorize?client_id="+o+"&duration="+s+"&response_type=code&redirect_uri="+encodeURIComponent(a)}),t.end()},e.exchangeAuthorizationCode=function(t,r){var o=Object(n.c)({portal:"https://www.arcgis.com/sharing/rest",refreshTokenTTL:1440},t),s=o.portal,a=o.clientId,u=o.redirectUri,c=o.refreshTokenTTL
return i(s+"/oauth2/token",{params:{grant_type:"authorization_code",client_id:a,redirect_uri:u,code:r}}).then(function(t){return new e({clientId:a,portal:s,ssl:t.ssl,redirectUri:u,refreshToken:t.refreshToken,refreshTokenTTL:c,refreshTokenExpires:new Date(Date.now()+1e3*(c-1)),token:t.token,tokenExpires:t.expires,username:t.username})})},e.deserialize=function(t){var r=JSON.parse(t)
return new e({clientId:r.clientId,refreshToken:r.refreshToken,refreshTokenExpires:new Date(r.refreshTokenExpires),username:r.username,password:r.password,token:r.token,tokenExpires:new Date(r.tokenExpires),portal:r.portal,ssl:r.ssl,tokenDuration:r.tokenDuration,redirectUri:r.redirectUri,refreshTokenTTL:r.refreshTokenTTL})},e.fromCredential=function(t){return new e({portal:t.server.includes("sharing/rest")?t.server:t.server+"/sharing/rest",ssl:t.ssl,token:t.token,username:t.userId,tokenExpires:new Date(t.expires)})},Object.defineProperty(e.prototype,"token",{get:function(){return this._token},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tokenExpires",{get:function(){return this._tokenExpires},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"refreshToken",{get:function(){return this._refreshToken},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"refreshTokenExpires",{get:function(){return this._refreshTokenExpires},enumerable:!0,configurable:!0}),e.prototype.toCredential=function(){return{expires:this.tokenExpires.getTime(),server:this.portal,ssl:this.ssl,token:this.token,userId:this.username}},e.prototype.getUser=function(e){var t=this
if(this._user&&this._user.username===this.username)return Promise.resolve(this._user)
var r=this.portal+"/community/users/"+encodeURIComponent(this.username),i=Object(n.c)({httpMethod:"GET",authentication:this},e,{rawResponse:!1})
return Object(n.u)(r,i).then(function(e){return t._user=e,e})},e.prototype.getToken=function(e,t){return n=e,i=a(r=this.portal),o=a(n),s=u(r),c=u(n),i&&o&&s===c||new RegExp(this.portal,"i").test(e)?this.getFreshToken(t):this.getTokenForServer(e,t)
var r,n,i,o,s,c},e.prototype.toJSON=function(){return{clientId:this.clientId,refreshToken:this.refreshToken,refreshTokenExpires:this.refreshTokenExpires,username:this.username,password:this.password,token:this.token,tokenExpires:this.tokenExpires,portal:this.portal,ssl:this.ssl,tokenDuration:this.tokenDuration,redirectUri:this.redirectUri,refreshTokenTTL:this.refreshTokenTTL}},e.prototype.serialize=function(){return JSON.stringify(this)},e.prototype.refreshSession=function(e){return this._user=null,this.username&&this.password?this.refreshWithUsernameAndPassword(e):this.clientId&&this.refreshToken?this.refreshWithRefreshToken():Promise.reject(new n.a("Unable to refresh token."))},e.prototype.getServerRootUrl=function(e){var t=Object(n.f)(e).split(/\/rest(\/admin)?\/services(?:\/|#|\?|$)/)[0].match(/(https?:\/\/)(.+)/),r=t[1],i=t[2].split("/"),o=i[0],s=i.slice(1)
return""+r+o.toLowerCase()+"/"+s.join("/")},e.prototype.getTokenForServer=function(e,t){var r=this,i=this.getServerRootUrl(e),s=this.trustedServers[i]
return s&&s.expires&&s.expires.getTime()>Date.now()?Promise.resolve(s.token):(this._pendingTokenRequests[i]||(this._pendingTokenRequests[i]=Object(n.u)(i+"/rest/info").then(function(o){if(o.owningSystemUrl){if(c(o.owningSystemUrl,r.portal))return Object(n.u)(o.owningSystemUrl+"/sharing/rest/info",t)
throw new n.a(e+" is not federated with "+r.portal+".","NOT_FEDERATED")}if(o.authInfo&&void 0!==r.trustedServers[i])return Promise.resolve({authInfo:o.authInfo})
throw new n.a(e+" is not federated with any portal and is not explicitly trusted.","NOT_FEDERATED")}).then(function(e){return e.authInfo.tokenServicesUrl}).then(function(t){return r.token&&r.tokenExpires.getTime()>Date.now()?o(t,{params:{token:r.token,serverUrl:e,expiration:r.tokenDuration,client:"referer"}}):o(t,{params:{username:r.username,password:r.password,expiration:r.tokenDuration,client:"referer"}}).then(function(e){return r._token=e.token,r._tokenExpires=new Date(e.expires),e})}).then(function(e){return r.trustedServers[i]={expires:new Date(e.expires),token:e.token},delete r._pendingTokenRequests[i],e.token})),this._pendingTokenRequests[i])},e.prototype.getFreshToken=function(e){var t=this
return this.token&&this.tokenExpires&&this.tokenExpires.getTime()>Date.now()?Promise.resolve(this.token):(this._pendingTokenRequests[this.portal]||(this._pendingTokenRequests[this.portal]=this.refreshSession(e).then(function(e){return t._pendingTokenRequests[t.portal]=null,e.token})),this._pendingTokenRequests[this.portal])},e.prototype.refreshWithUsernameAndPassword=function(e){var t=this,r=Object(n.c)({params:{username:this.username,password:this.password,expiration:this.tokenDuration}},e)
return o(this.portal+"/generateToken",r).then(function(e){return t._token=e.token,t._tokenExpires=new Date(e.expires),t})},e.prototype.refreshWithRefreshToken=function(e){var t=this
if(this.refreshToken&&this.refreshTokenExpires&&this.refreshTokenExpires.getTime()<Date.now())return this.refreshRefreshToken(e)
var r=Object(n.c)({params:{client_id:this.clientId,refresh_token:this.refreshToken,grant_type:"refresh_token"}},e)
return i(this.portal+"/oauth2/token",r).then(function(e){return t._token=e.token,t._tokenExpires=e.expires,t})},e.prototype.refreshRefreshToken=function(e){var t=this,r=Object(n.c)({params:{client_id:this.clientId,refresh_token:this.refreshToken,redirect_uri:this.redirectUri,grant_type:"exchange_refresh_token"}},e)
return i(this.portal+"/oauth2/token",r).then(function(e){return t._token=e.token,t._tokenExpires=e.expires,t._refreshToken=e.refreshToken,t._refreshTokenExpires=new Date(Date.now()+60*(t.refreshTokenTTL-1)*1e3),t})},e}(),p=function(){var e=document.cookie.match("(^|[^;]+)\\s*arcgis_hub_component_auth\\s*=\\s*([^;]+)")
return e?e.pop():void 0},l=function(e){var t=new Date
t.setTime(t.getTime()+12096e5),document.cookie="arcgis_hub_component_auth="+e.serialize()+" ; expires="+t.toUTCString()+" path=/"}}}])
